{
    "contents" : "#'Calculate 'standard' Z-score\n#'\n#'@details In the Z-score approach, introduced by Chiu et al in 2008, \n#'the chromosomal fraction of interest of a sample is compared \n#'to the chromosomal fractions of interest of the reference samples, \n#'the `NIPTControlGroup` object.\n#'The output of the function is an object of class `ZscoreResult`. It is a named list containing seven fields:\n#'\\itemize{\n#'\\item numeric \\strong{sample_Zscore} The Z score for the sample of interest for the sample of interest\n#'\\item named num \\strong{control_group_statistics} Named num of length 3, the first field being the \n#'mean (name mean), the second field is the standard deviation (name SD) \n#'and the third field is the P value of the Shapiro-Wilk test (name Shapiro_P_value)\n#'\\item matrix \\strong{control_group_Zscores} containing the Z scores of the chromosome of interest for \n#'all used control samples\n#'\\item integer \\strong{focus_chromosome} The chromosome of interest. Most commonly chromosome 13, 18 or 21.\n#' However, every autosomal chromosome can be predicted\n#'\\item string \\strong{control_group_sample_names} The sample names of all control group samples used in the\n#' analysis\n#'\\item string \\strong{correction_status} The correction status of the control group\n#'\\item string \\strong{sample_name} The sample_name of the sample of interest\n#'}\n#'@param nipt_sample  The NIPTSample object that is the focus of the analysis\n#'@param nipt_control_group The NIPTControlGroup object used in the analysis\n#'@param chromo_focus The chromosome of interest. Most commonly chromosome 13, 18 or 21. \n#'However, every autosomal chromosome can be predicted\n#'\n#'@return ZscoreResult object\n#'\n#'@export\ncalculate_z_score <- function(nipt_sample, nipt_control_group, chromo_focus){\n  control_group_fractions <- sapply(X = nipt_control_group[[samples]], FUN = chrfractions)\n  sample_fractions <- sapply(list(nipt_sample), chrfractions)\n  control_group_fractions <- setrownamesmatrix(control_group_fractions)\n  sample_fractions <- setrownamesmatrix((sample_fractions))\n  chromo_focus_fractions <- getstats(fractions = control_group_fractions, chromo_focus = chromo_focus)\n  mean_control <- mean(chromo_focus_fractions)\n  sd_control <-  sd(chromo_focus_fractions)\n  sample_focus_fractions <- getstats(fractions = sample_fractions, chromo_focus = chromo_focus)\n  sample_score <- unname((sample_focus_fractions - mean_control) /sd_control)\n  control_scores <- scale(chromo_focus_fractions)\n  control_names <- sapply(nipt_control_group[[samples]], getsamplenames)\n  dimnames(control_scores) <- list(control_names, \"Z_score\")\n  new_z_result <- z_score_template(statistics = c(mean = mean_control, SD = sd_control, \n                                                  Shapiro_P_value = shapiro.test(control_scores)$p.value),\n                                   control_group_scores = control_scores, chromo_focus = chromo_focus,\n                                   nipt_sample_names = control_names, correction_status = unique(nipt_control_group$correction_status),\n                                   sample_name = getsamplenames(nipt_sample), sample_Zscore = sample_score,\n                                   type = class(nipt_control_group)[2])\n  return(new_z_result)\n}\n\nz_score_template <- function(statistics, control_group_scores, chromo_focus, nipt_sample_names, correction_status,\n                             sample_Zscore, sample_name, type){\n  new_z_score_template <- list(sample_Zscore = sample_Zscore, control_group_statistics = statistics, \n                               control_group_Zscores= control_group_scores,\n                               focus_chromosome = as.character(chromo_focus),\n                               control_group_sample_names = nipt_sample_names, \n                               correction_status = correction_status,\n                               sample_name = sample_name)\n  \n  class(new_z_score_template) <- c(Z_template_class, type)\n  \n  return(new_z_score_template)\n  \n}\n\ngetstats <- function(fractions, chromo_focus){\n \n  if (nrow(fractions) == 44){\n \n  chromo_focus_fractions <- fractions[chromo_focus,] + fractions[chromo_focus + 22,]\n  }\n  else{\n  chromo_focus_fractions <- fractions[chromo_focus,]\n  }\n  return(chromo_focus_fractions)\n}",
    "created" : 1445331285611.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "4119882552",
    "id" : "4E188465",
    "lastKnownWriteTime" : 1446124093,
    "path" : "~/NIPTeR/NIPTeR/R/z_score.R",
    "project_path" : "R/z_score.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "type" : "r_source"
}